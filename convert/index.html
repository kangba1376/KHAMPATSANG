<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>藏文编码大师 - 康巴仓</title>
    <style>
        :root { --藏袍红: #8b0000; --哈达白: #fdfaf2; --酥油金: #d4af37; }
        body { font-family: "Microsoft Himalaya", sans-serif; background: var(--哈达白); margin: 0; padding: 15px; }
        .容器 { width: 100%; max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 8px solid var(--藏袍红); }
        h2 { color: var(--藏袍红); text-align: center; font-size: 24px; border-bottom: 2px solid var(--酥油金); padding-bottom: 10px; }
        .状态 { text-align: center; color: #666; font-size: 14px; margin-bottom: 15px; background: #eee; padding: 5px; border-radius: 5px; }
        textarea { width: 100%; height: 200px; border: 2px solid #eee; border-radius: 10px; padding: 15px; font-size: 22px; box-sizing: border-box; line-height: 1.6; outline: none; }
        .按钮区 { text-align: center; margin: 25px 0; }
        button { background: var(--藏袍红); color: white; border: none; padding: 16px 60px; font-size: 20px; border-radius: 50px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
<div class="容器">
    <h2>ཁམས་པ་ཚང་། 藏文九合一转码 (喜马拉雅标准)</h2>
    <div id="status" class="状态">正在同步映射数据库...</div>
    <b>第一步：粘贴旧编码文本（BZD, DL, FZ等）</b>
    <textarea id="input"></textarea>
    <div class="按钮区"><button onclick="执行转换()">一键转为喜马拉雅码</button></div>
    <b>第二步：喜马拉雅标准编码结果</b>
    <textarea id="output" readonly></textarea>
</div>
<script>
    let 映射表 = new Map();
    async function 初始化() {
        try {
            const 响应 = await fetch('tibet_master_map.json');
            const 数据 = await 响应.json();
            ["BZD", "DL", "FZ", "HG", "HKA", "JM", "PX", "SAM", "TY"].forEach(字库 => {
                if(数据[字库]) {
                    数据[字库].split('ᔘ').forEach(对 => {
                        const 部分 = 对.split('ᔜ');
                        if (部分.length === 2) 映射表.set(部分[0], 部分[1]);
                    });
                }
            });
            document.getElementById('status').innerText = "✅ 映射库加载成功，共 " + 映射表.size + " 条";
        } catch (e) { document.getElementById('status').innerText = "❌ 加载失败，请确保 json 已上传"; }
    }
    function 执行转换() {
        const 输入 = document.getElementById('input').value;
        let 结果 = "";
        for (let 字符 of 输入) { 结果 += 映射表.get(字符) || 字符; }
        document.getElementById('output').value = 结果;
    }
    初始化();
</script>
</body>
</html>
