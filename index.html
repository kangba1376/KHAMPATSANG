<!DOCTYPE html>
<html lang="bo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ཁམས་པ་ཚང་བོད་ཡིག་ཨང་བསྒྱུར།</title>
    <style>
        @font-face { font-family: 'TibetWildYak'; src: url('TibetWildYak.ttf') format('truetype'); }
        :root { --main-red: #8b0000; --white: #fdfaf2; }
        body { font-family: 'TibetWildYak', serif; background: var(--white); display: flex; justify-content: center; padding: 15px; }
        .container { width: 100%; max-width: 800px; background: white; padding: 25px; border-radius: 15px; border-top: 8px solid var(--main-red); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { color: var(--main-red); text-align: center; border-bottom: 2px solid #d4af37; padding-bottom: 10px; }
        .status { text-align: center; color: #666; background: #eee; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
        textarea { width: 100%; height: 200px; border: 2px solid #eee; border-radius: 10px; padding: 15px; font-size: 26px; font-family: 'TibetWildYak', sans-serif; box-sizing: border-box; }
        .btn-box { text-align: center; margin: 25px 0; }
        button { background: var(--main-red); color: white; border: none; padding: 16px 60px; font-size: 24px; border-radius: 50px; cursor: pointer; font-family: 'TibetWildYak'; }
    </style>
</head>
<body>
<div class="container">
    <h2>ཁམས་པ་ཚང་བོད་ཡིག་ཨང་བསྒྱུར།</h2>
    <div id="status" class="status">Loading...</div>
    <textarea id="input" placeholder="པཎྜི་ཏ་སོགས་འདི་ན་འཇུག་དགོས།..."></textarea>
    <div class="btn-box"><button onclick="执行转换()">ཧི་གཟུགས་སུ་བསྒྱུར།</button></div>
    <b>ཧི་གཟུགས་འོག་ནས་བཤུ་རོགས།(Unicode)</b>
    <textarea id="output" readonly></textarea>
</div>

<script>
    let 映射表 = new Map();

    async function 初始化() {
        try {
            const 响应 = await fetch('tibet_master_map.json');
            const 数据 = await 响应.json();

            // 解析旧编码的不同字库，确保正确加载所有映射
            ["BZD", "DL", "FZ", "HG", "HKA", "JM", "PX", "SAM", "TY"].forEach(字库 => {
                if (数据[字库]) {
                    数据[字库].split('ᔘ').forEach(对 => {
                        const 部分 = 对.split('ᔜ');
                        if (部分.length === 2) {
                            映射表.set(部分[0], 部分[1]);
                        }
                    });
                }
            });
            document.getElementById('status').innerText = "✅ 映射库加载成功，共 " + 映射表.size + " 条";
        } catch (e) {
            document.getElementById('status').innerText = "❌ 加载失败，请确保 json 已上传";
        }
    }

    // 执行转换
    function 执行转换() {
        const 输入 = document.getElementById('input').value;
        let 结果 = "";

        // 遍历输入字符进行转换
        for (let 字符 of 输入) {
            // 查找映射，如果没有映射则保留原字符
            结果 += 映射表.get(字符) || 字符;
        }

        document.getElementById('output').value = 结果;
    }

    初始化();
</script>

</body>
</html>
